<!DOCTYPE html>
<html>

<head>

</head>

<body>
    <div id="container" style="width:100%; height:90vh;"></div>
    <script src="/highcharts-v8.2.2.js"></script>
    <script>
        function f(url, callback) {
            fetch(url)
                .then((response) => {
                    if (response.ok) {
                        return Promise.resolve(response)
                    } else {
                        return Promise.reject(new Error(response.statusText))
                    }
                })
                .then((response) => {
                    return response.json()
                })
                .then(callback)
                .catch((error) => {
                    console.log('Request failed', error)
                })
        }

        var timeline_data = {
            labels: [],
            series: []
        }

        var URL_timeline = "https://api.corona.app.5ls.de/timeline"
        //URL_timeline = "https://cors-anywhere.herokuapp.com/" + URL_timeline

        f(URL_timeline, (data) => {
            timeline_data.labels = []
            timeline_data.series = [{
                name: "confirmed",
                data: [],
                visible: false
            }, {
                name: "recovered",
                data: [],
                visible: false
            }, {
                name: "active",
                data: []
            }, {
                name: "deaths",
                data: []
            }, {
                name: "diff",
                data: []
            }]

            data.timeline.forEach(element => {
                let dateSplit = element.date.split("-")
                let label = dateSplit[2].split("T")[0] + "." + dateSplit[1]

                timeline_data.labels.push(label)
                timeline_data.series[0].data.push(element.confirmed)
                timeline_data.series[1].data.push(element.recovered)
                timeline_data.series[2].data.push(element.active)
                timeline_data.series[3].data.push(element.deaths)
                timeline_data.series[4].data.push(element.diff)
            })

            plot()
        })


        function plot() {

            const chart = Highcharts.chart('container', {
                chart: {
                    /* type: 'area' */
                    scrollablePlotArea: {
                        minWidth: 700
                    }
                },
                chart: {
                    zoomType: 'x'
                },
                title: {
                    text: 'Timeline'
                },
                subtitle: {
                    text: document.ontouchstart === undefined ?
                        'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in'
                },
                tooltip: {
                    shared: true,
                    crosshairs: true
                },
                xAxis: {
                    type: 'datetime',
                    categories: timeline_data.labels
                },
                yAxis: {
                    title: {
                        text: 'FÃ¤lle'
                    }
                },

                series: timeline_data.series
            });
        }
    </script>
</body>

</html>
